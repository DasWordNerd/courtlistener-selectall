{% extends "base.html" %}
{% load static %}
{% load extras %}

{% block title %}Webhook API &ndash; CourtListener.com{% endblock %}
{% block description %}
  CourtListener’s webhook system allows us to push information to you, enabling bi-directional APIs without the need for polling.
{% endblock %}

{% block sidebar %}{% endblock %}

{% block footer-scripts %}
  {% include "includes/anchors.html" %}
{% endblock %}

{% block content %}
<div class="col-sm-7">
  <h1 id="about">Webhook API</h1>
  <p class="lead">CourtListener’s webhook system allows us to push information to you, enabling bi-directional APIs without the need for polling.
  </p>
  <p>To set this up, you create a URL on your server where CourtListener can send data. Then, whenever something important happens in CourtListener, we will POST an “event” to that URL as JSON data. When you receive the event, you can process it and perform whatever actions your system needs in response.
  </p>
  <p>Currently, CourtListener can send webhook events whenever dockets are updated. We are also contemplating or working on sending events when <a href="https://github.com/freelawproject/courtlistener/issues/2382" rel="nofollow" target="_blank">docket alerts expire</a>, when <a href="https://github.com/freelawproject/courtlistener/issues/854" rel="nofollow" target="_blank">search alerts are triggered</a>, when <a href="https://github.com/freelawproject/courtlistener/issues/703" rel="nofollow" target="_blank">RECAP Fetch tasks complete</a>, and more. If you have other events of interest, please get in touch.
  </p>

  <h2 id="getting-started">Getting Started With Webhooks</h2>
  <p>Creating your first webhook working can be complicated. To get an overview of the process, please read <a href="{% url 'webhooks_getting_started' %}">our documentation on getting started</a>.
  </p>

  <h2 id="overview-of-events">Overview of Events</h2>
  <h3 id="headers">Headers</h3>
  <p>Each webhook event contains two HTTP headers with additional context for the event:
  </p>
  <ul>
    <li>
      <p><strong>Content-Type</strong>: Indicates the content type of the payload request. For now, our events only support <code>"application/json"</code>.
      </p>
    </li>
    <li>
      <p><strong>Idempotency-Key</strong>: This is a unique 128 bit UUID that corresponds to each event. This value should be used by your application to ensure that you do not process events more than once.</p>
      <p>If you do not take advantage of this feature, we may resend an event that appeared to fail, and you may receive and process it multiple times. More details about this are available in <a href="#retries">the section on retries below</a>.</p>
    </li>
  </ul>

  <h2>Fields</h2>
  <p>Each webhook event is a JSON hash with two keys, <code>payload</code> and <code>webhook</code>. The <code>payload</code> key contains the specific data for the event that occurred. Its values are described in the <a href="#event-types">event-specific descriptions below</a>.
  </p>
  <p>The <code>webhook</code> key helps with maintenance and compatibility. It contains information about the webhook itself. This key should be monitored by administrators and used to track the deprecation schedule for the webhook events.
  </p>
  <p>It has the following structure:
  </p>

  <div class="payload">
    <p><strong>webhook</strong> <span class="text-muted">JSON hash</span></p>
    <p>Information related to the webhook endpoint to which the event belongs.</p>
    <p>Show child attributes <a data-toggle="collapse" href="#webhook-collapse" role="button" aria-expanded="false" aria-controls="collapseExample">[+]</a></p>
    <div class="collapse" id="webhook-collapse">
      <div class="card card-body webhook-child">
        <p><strong>version</strong> <span class="text-muted">integer</span></p>
        <p>The specific version of the webhook event.</p>
        <hr>
        <p><strong>event_type</strong> <span class="text-muted">integer</span></p>
        <p>The webhook event type.</p>
        <ul>
          <li>DOCKET_ALERT = 1</li>
          <li>SEARCH_ALERT = 2</li>
          <li>RECAP_FETCH = 3</li>
        </ul>
        <hr>
        <p><strong>date_created</strong> <span class="text-muted">string</span></p>
        <p>The DateTime (ISO 8601 format) in which the webhook endpoint was created.</p>
        <hr>
        <p><strong>deprecation_date</strong> <span class="text-muted">string or null </span></p>
        <p>The next deprecation date if scheduled, otherwise null.</p>
      </div>
    </div>
  </div>
  <hr>
  <h2 id="security">Webhook Security</h2>
  <p>At present, our webhook system does not have an authentication mechanism to verify that a POST to your endpoint came from CourtListener. To provide some level of safety, <strong>we recommend you use a long, random URL as your endpoint</strong>, and we advise you to keep that URL secret.
  </p>
  <p>The <a href="https://github.com/freelawproject/courtlistener/issues/1650" rel="nofollow" target="_blank">decision not to support an authentication mechanism</a> was made after analyzing the risk of lacking authentication and after completing a review of the Stripe payments platform (which defaults to not using authentication despite being a high-risk environment).
  </p>
  <p>So far, none of our clients have requested that we add this feature nor demonstrated a need for it. If the need for webhook authentication is a blocker for your organization, <a href="{% url 'contact' %}">please let us know</a> and we can build a solution together.
  </p>

  <h2 id="retries">Retries and Automatic Endpoint Disablement</h2>
  <p>Errors across distributed systems like webhooks are inevitable. To make our webhooks system resilient, we automatically retry events POSTed to your application that do not receive a 2xx status code response within one second.
  </p>
  <p>Events are retried up to seven times after the first failure. The retry logic uses an exponential backoff starting at roughly three minutes with a 3× multiplier. As shown in the table below, this gives you around 54 hours to fix any issues in your system. The next attempt date and time for a specific event can be found <a href="{% url 'view_webhook_logs' 'logs' %}">in the webhook logs</a>.
  </p>
  <p>As webhooks fail to be delivered, we will send emails to your account informing you of the issue. Email notifications are sent per webhook endpoint based on the first failing event for that endpoint — Notifications are not sent for every failing event, since that would flood your inbox.
  </p>
  <p>This table explains the retry and notification schedule (in minutes) for failing events:</p>

  <table class="table">
  <tbody>
      <tr>
          <td class="text-center"><p><strong>Retry Count</strong></p></td>
          <td class="text-center"><p><strong>New Delay</strong></p></td>
          <td class="text-center"><p><strong>Elapsed</strong></p></td>
          <td class="text-center"><p><strong>Send Failure Notification Email?</strong></p></td>
      </tr>
      <tr>
          <td class="text-center"><p>1</p></td>
          <td class="text-center"><p>0:03</p></td>
          <td class="text-center"><p>0:03</p></td>
          <td class="text-center"><p>Yes</p></td>
      </tr>
      <tr>
          <td class="text-center"><p>2</p></td>
          <td class="text-center"><p>0:09</p></td>
          <td class="text-center"><p>0:12</p></td>
          <td class="text-center"><p>No</p></td>
      </tr>
      <tr>
          <td class="text-center"><p>3</p></td>
          <td class="text-center"><p>0:27</p></td>
          <td class="text-center"><p>0:39</p></td>
          <td class="text-center"><p>No</p></td>
      </tr>
      <tr>
          <td class="text-center"><p>4</p></td>
          <td class="text-center"><p>1:21</p></td>
          <td class="text-center"><p>2:00</p></td>
          <td class="text-center"><p>No</p></td>
      </tr>
      <tr>
          <td class="text-center"><p>5</p></td>
          <td class="text-center"><p>4:03</p></td>
          <td class="text-center"><p>6:03</p></td>
          <td class="text-center"><p>Yes</p></td>
      </tr>
      <tr>
          <td class="text-center"><p>6</p></td>
          <td class="text-center"><p>12:09</p></td>
          <td class="text-center"><p>18:12</p></td>
          <td class="text-center"><p>No</p></td>
      </tr>
      <tr>
          <td class="text-center"><p>7</p></td>
          <td class="text-center"><p>36:27</p></td>
          <td class="text-center"><p>54:39</p></td>
          <td class="text-center"><p>Yes</p></td>
      </tr>
      </tbody>
  </table>
  <p>After a webhook fails eight times, it is disabled in our system and we immediately stop sending it new or undelivered events.
  </p>
  <p>At that point, you will have received two warning emails about the issue, and a third informing you that the endpoint is disabled. Webhooks can be re-enabled at any time, but will get disabled again if errors continue.
  </p>
  <p>Fixed webhook endpoints can be re-enabled in the webhooks panel.
  </p>
  <p>
    <img src="{% static "png/re-enable-webhook.png" %}"
       alt="screenshot of how to re-enable a webhook endpoint"
       class="img-responsive img-rounded shadow center-block"
       height="261"
       width="652">
  </p>
  <p>Once your webhook endpoint is re-enabled, we will continue attempting to deliver failed webhook events that we stopped retrying when the endpoint was disabled, if those events occurred within the last two days.
  </p>

  <h2 id="event-types">Event Types</h2>
  <h3>Docket Alert Events</h3>
  <p>If you wish to receive events when particular dockets are updated in CourtListener, you must first “subscribe” to dockets.</p>
  <p>A docket subscription can be created in one of three ways:
  </p>
  <ol>
    <li>
      <strong>For normal users</strong>, the best way is <a href="{% url 'alert_help' %}#recap-alerts">via the CourtListener website itself</a>.
    </li>
    <li>
      <p><strong>For servers</strong>, the best way is to use the Docket Alert endpoint of our REST API.</p>
      <p>For example, this shell code searches for the <a href="{% url 'view_docket' '64911367' 'trump-v-united-states' %}">Trump Mar-A-Lago</a> case and then subscribes your account to it:</p>
      <pre class="v-offset-below-1 scrollable" >curl --silent '{% get_full_host %}{% url "search-list" version="v3" %}?type=d&docket_number=22-cv-81294&case_name=trump' | \
    jq '.results[0].docket_id' | \
    xargs curl -X POST --data docket_id=$1 --header 'Authorization: Token {% if user.is_authenticated %}{{ user.auth_token }}{% else %}&lt;your-token-here&gt;{% endif %}' 'https://www.courtlistener.com/api/rest/v3/docket-alert/'</pre>
    </li>
    <li>
      <p><strong>For users</strong> of <a href="{% url 'recap_email_help' %}">@recap.email</a>, the best way to subscribe to a case is to have <a href="{% url 'view_recap_email' %}">auto-subscribe turned on in your settings</a>.
      </p>
      <p>
        When auto-subscribe is on, you will automatically be subscribed to cases when we receive your PACER notifications for them. For users that wish to subscribe to all the cases for which they get PACER notifications, this is usually the best way to do so.
      </p>
    </li>
  </ol>
  <p>
    Once subscribed to a case, we will begin POSTing events to your Docket Alert webhook endpoint whenever that case gets new filings.
  </p>
  <p>
    The webhook event is a JSON hash with two keys, <code>webhook</code> and <code>payload</code>, as described above. The <code>payload</code> key  for Docket Alert events is a JSON hash <code>payload: {results: []}</code> that contains the <code>results</code> key that’s based on the  <a href="{% url 'rest_docs' %}#docket-entry-endpoint">Docket Entry API endpoint</a> and has all of the same fields. To get a description of the fields, do an HTTP OPTIONS request to the endpoint:
  </p>
  <pre class="v-offset-below-1 scrollable" >curl -X OPTIONS --header 'Authorization: Token {% if user.is_authenticated %}{{ user.auth_token }}{% else %}&lt;your-token-here&gt;{% endif %}' '{% get_full_host %}{% url "recapdocument-list" version="v3" %}'</pre>
  <p>
    You can also learn more about the API in the API documentation, where we explain how to <a href="{% url 'rest_docs' %}#downloading-files">download files from the API</a> and list <a href="{% url 'rest_docs' %}#field-details">a few field-specific tips</a>.
  </p>
</div>


<div class="col-sm-5">
  <div class="sidebar-section">
    <h3><span>Table of Contents</span></h3>
    <ul>
      <li><a href="#getting-started">Getting Started With Webhooks</a></li>
      <li><a href="#overview-of-events">Overview of Events</a></li>
      <li><a href="#event-types">Event Types</a></li>
    </ul>
  </div>


  <div class="sidebar-section">
    <h3><span>Powered By</span></h3>
    <p> If you are interested, we have a variety of <a href="https://free.law/press-assets/">"Powered By" logos</a> available for your website or application. We appreciate a reference, and it supports our work, but it's not currently required.
    </p>
    <a href="https://free.law/press-assets/">
      <img src="{% static "png/logo-long-w350.png" %}" width="350" height="81">
    </a>
  </div>

  <div class="sidebar-section">
    <h3><span>Maintenance Schedule</span></h3>
    <p>Generally, we keep the APIs up and running around the clock, but for the rare times where maintenance requires downtime, we will schedule that downtime during a weekly maintenance window from 21:00-23:59PT on a Thursday night. If you are scheduling cron jobs or otherwise crawling the API, you may experience downtime during this window.
    </p>
    <p>Additionally, we regularly perform bulk tasks on our servers and maintain <a href="https://www.google.com/calendar/embed?src=michaeljaylissner.com_fvcq09gchprghkghqa69be5hl0@group.calendar.google.com&ctz=America/Los_Angeles">a public calendar</a> for tracking them. You may encounter larger delays while bulk processing jobs are running.
    </p>
  </div>


  {% include "includes/deprecated_webhooks_sidebar_section.html" %}

  <div class="sidebar-section">
    <h3 id="copyright"><span>Copyright</span></h3>
    <p>Our data is free of known copyright restrictions.<br />
      <a rel="license" href="http://creativecommons.org/publicdomain/mark/1.0/">
        <img src="https://i.creativecommons.org/p/mark/1.0/88x31.png" alt="Public Domain Mark" height="31" width="88"/>
      </a>
    </p>
  </div>
</div>
{% endblock %}
